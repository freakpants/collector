<!doctype html>
<html>

<head>
  <title>Futties Collector</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="jQuery.print.min.js"></script>
  <link rel="stylesheet" href="css.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Secular+One">
</head>

<body>

  <div id="twitter_link">
    <a href="https://twitter.com/FUTCoder" class="futcoder" target="_blank"><img src="roundlogo.png"></a>
  </div>
  <div id="overlay_bg"></div>
  <div class="futties-header">
    <div id="show_legend" class='token_number_legend'>?</div>
    <h1>FUT22 Collector</h1>
    <div id="futties_counters">
      <h3>Collected: <span id="collected">0/482</span></h3>
      <h3>Displaying: <span id="displaying">200/482</span></h3>
    </div>
    <div id="search">
      <input type="text" placeholder="..player name (lowercase)">
    </div>
    <button id="export_link" class="export btn-standard call-to-action">
      <span class="button__text">Export link</span>
    </button>
    <button class="unclaim btn-standard call-to-action">
      <span class="button__text">Uncollect</span>
    </button>
    <button class="print btn-standard call-to-action">
      <span class="button__text">Print</span>
    </button>
    <div id="batch_wrapper">
      <select id="batch_select">
        <option selected value="preseason_2">Preseason 2 (5)</option>
        <option value="futties_123">Futties 1-3 PP</option>
        <option value="campaign">Campaign Bag PP (6)</option>
        <option value="ss_pp">Shapeshifters PP (7)</option>
        <option value="icons">93+ Icon Moments PP (8)</option>
        <option value="preseason_1">Preseason 1 (4)</option>
        <option value="futties_3">Futties 3 (3)</option>
        <option value="futties_2">Futties 2 (2)</option>
        <option value="futties_1">Futties 1 (1)</option>
        <option value="all">Everything</option>
      </select>
      <div>
        <input type="checkbox" id="togglemissing" name="togglemissing">
        <label for="togglemissing">Hide unavailable batches</label>
      </div>
      <div>
        <input type="checkbox" id="togglesource" name="togglesource">
        <label for="togglesource">Hide source for collected cards</label>
      </div>
    </div>
    <div id="checkbox_wrapper" class="checkbox_wrapper_futties">
      <div>
        <input type="checkbox" id="toggleall" name="toggleall" checked>
        <label for="toggleall">Toggle All</label>
      </div>
      <div>
        <input type="checkbox" id="icons" name="icons" checked>
        <label for="icons">Icons</label>
      </div>
      <div>
        <input type="checkbox" id="shapeshifters" name="shapeshifters" checked>
        <label for="shapeshifters">Shapeshifters</label>
      </div>
      <div>
        <input type="checkbox" id="toty" name="toty" checked>
        <label for="toty">TOTY</label>
      </div>
      <div>
        <input type="checkbox" id="tots" name="tots" checked>
        <label for="tots">TOTS</label>
      </div>
      <div>
        <input type="checkbox" id="uefa" name="uefa" checked>
        <label for="uefa">UEFA Leagues</label>
      </div>
      <div>
        <input type="checkbox" id="fantasy" name="fantasy" checked>
        <label for="fantasy">FUT Fantasy</label>
      </div>
      <div>
        <input type="checkbox" id="headliners" name="headliners" checked>
        <label for="headliners">Headliners</label>
      </div>
      <div>
        <input type="checkbox" id="captains" name="captains" checked>
        <label for="captains">FUT Captains</label>
      </div>
      <div>
        <input type="checkbox" id="promo" name="promo" checked>
        <label for="promo">TOTGS</label>
      </div>
      <div>
        <input type="checkbox" id="futurestars" name="futurestars" checked>
        <label for="futurestars">Future Stars</label>
      </div>
      <div>
        <input type="checkbox" id="birthday" name="birthday" checked>
        <label for="birthday">FUT Birthday</label>
      </div>
      <div>
        <input type="checkbox" id="wildcard" name="wildcard" checked>
        <label for="wildcard">Winter Wildcards</label>
      </div>
      <div>
        <input type="checkbox" id="signature" name="signature" checked>
        <label for="signature">Signature Signings</label>
      </div>
      <div>
        <input type="checkbox" id="numbersup" name="numbersup" checked>
        <label for="numbersup">Numbersup</label>
      </div>
      <div>
        <input type="checkbox" id="totw" name="totw" checked>
        <label for="totw">TOTW</label>
      </div>
      <div>
        <input type="checkbox" id="honourable" name="honourable" checked>
        <label for="honourable">TOTY Honour</label>
      </div>
      <div>
        <input type="checkbox" id="libertadores" name="libertadores" checked>
        <label for="libertadores">Libertadores</label>
      </div>
      <div>
        <input type="checkbox" id="halloween" name="halloween" checked>
        <label for="halloween">Rulebreakers</label>
      </div>
      <div>
        <input type="checkbox" id="otw" name="otw" checked>
        <label for="otw">Ones To Watch</label>
      </div>
      <div>
        <input type="checkbox" id="versus" name="versus" checked>
        <label for="versus">FUT Versus</label>
      </div>
      <div>
        <input type="checkbox" id="motm" name="motm" checked>
        <label for="motm">MOTM</label>
      </div>
    </div>
  </div>
  <div id="legend_wrapper">
    The numbers above each card tell you in which batch or player pick the card was/is available. <br>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>1</div>
      <div class="legend_text">Futties Batch 1 (unavailable)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>2</div>
      <div class="legend_text">Futties Batch 2 (unavailable)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>3</div>
      <div class="legend_text">Futties Batch 3 (unavailable)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>4</div>
      <div class="legend_text">Preseason Batch 1 (unavailable)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>5</div>
      <div class="legend_text">Preseason Batch 2 (in Packs until September 23)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>6</div>
      <div class="legend_text">Campaign Bag Player Pick (unavailable)</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>7</div>
      <div class="legend_text">Shapeshifters Player Pick</div>
    </div>
    <div class="legend_line_wrapper">
      <div class='token_number_legend'>8</div>
      <div class="legend_text">93+ Icon Moments PP</div>
    </div>
  </div>
  <div id="counters">
    <h3>Claimed: <span id="claimed"></span></h3>
    <h3>Expired: <span id="expired"></span></h3>
    <h3>Missed: <span id="missed"></span></h3>
    <h3>Max. possible: <span id="max"></span></h3>
  </div>
  <div class="header">
    <h1>Summer Swaps 2</h1>
    <h2>Token Tracker</h2>
    <div id="attribution">
      <h3 id="docs">?</h3>
    </div>

    <div id="button-wrapper">

    </div>
    <div id="checkbox_wrapper" class="checkbox_wrapper_tokens">
      <div>
        <input type="checkbox" id="sbc" name="sbc" checked>
        <label for="sbc">SBC's</label>
      </div>
      <div>
        <input type="checkbox" id="objectives" name="objectives" checked>
        <label for="objectives">Objectives</label>
      </div>
      <div>
        <input type="checkbox" id="packs" name="packs" checked>
        <label for="packs">Packs</label>
      </div>
    </div>

  </div>
  <div id="tokens"></div>
</body>
<script>

cardArray = [
          "20801-173",
          "158023-173",
          "190043-84",
          "158023-64",
          "215914-173",
          "165153-11",
          "156616-173",
          "167425-173",
          "191972-173",
          "205498-64",
          "20801-64",
          "20801-11",
          "209331-11",
          "231747-64",
          "239818-64",
          "158023-11",
          "188545-11",
          "200104-173",
          "212622-11",
          "231677-173",
          "231747-11",
          "241721-11",
          "176676-173",
          "177003-11",
          "16619-173",
          "237063-84",
          "248449-84",
          "120274-173",
          "215914-64",
          "203376-11",
          "208722-11",
          "212188-173",
          "230621-64",
          "155862-173",
          "190871-11",
          "192985-11",
          "208722-124",
          "222492-173",
          "234396-173",
          "252371-11",
          "176580-11",
          "183277-173",
          "238794-11",
          "251854-11",
          "27-173",
          "192387-11",
          "210935-11",
          "211110-11",
          "232411-11",
          "246430-11",
          "212831-11",
          "167495-11",
          "188377-173",
          "199451-11",
          "200104-11",
          "201024-11",
          "206517-173",
          "207865-11",
          "210514-11",
          "220697-173",
          "232656-11",
          "239085-11",
          "239818-11",
          "240754-173",
          "241096-11",
          "245940-173",
          "256630-11",
          "188567-173",
          "192119-11",
          "210930-11",
          "213956-173",
          "216388-136",
          "231677-136",
          "239053-173",
          "240130-11",
          "242444-11",
          "246104-11",
          "1109-84",
          "173731-124",
          "231443-136",
          "188152-11",
          "190813-173",
          "202884-173",
          "235243-173",
          "238381-84",
          "238706-84",
          "242521-84",
          "247552-84",
          "256013-84",
          "150418-173",
          "20801-30",
          "209331-96",
          "216267-173",
          "226491-173",
          "189242-136",
          "189596-11",
          "195479-11",
          "212218-11",
          "216352-11",
          "218667-11",
          "231691-11",
          "233927-11",
          "241637-11",
          "245541-173",
          "255654-173",
          "168542-173",
          "171877-11",
          "193165-173",
          "197445-11",
          "204485-124",
          "215716-11",
          "253072-11",
          "176676-137",
          "244176-11",
          "13038-84",
          "6975-173",
          "178562-11",
          "190049-84",
          "210021-11",
          "223848-11",
          "237062-84",
          "238433-84",
          "238436-84",
          "238437-84",
          "239054-84",
          "239527-84",
          "243079-84",
          "247327-84",
          "255476-84",
          "255909-84",
          "258779-84",
          "260816-84",
          "51412-173",
          "155897-173",
          "167425-172",
          "203376-96",
          "235212-64",
          "167495-30",
          "183711-137",
          "188545-70",
          "189509-124",
          "193061-173",
          "193301-137",
          "203741-173",
          "208128-11",
          "208333-173",
          "212198-11",
          "234396-11",
          "236477-173",
          "251566-136",
          "252145-11",
          "252371-71",
          "146530-30",
          "176580-30",
          "177388-11",
          "188350-137",
          "190286-11",
          "190871-118",
          "192985-110",
          "200155-11",
          "200949-136",
          "205678-11",
          "207863-173",
          "216594-11",
          "220710-11",
          "226853-173",
          "234906-136",
          "241486-11",
          "241788-11",
          "251854-71",
          "192448-107",
          "211300-136",
          "190460-136",
          "5661-173",
          "193082-11",
          "211110-30",
          "212523-11",
          "237712-11",
          "238383-84",
          "238387-84",
          "238429-84",
          "238463-173",
          "239063-84",
          "239064-84",
          "239081-84",
          "239516-84",
          "239520-84",
          "239524-84",
          "239530-84",
          "239533-84",
          "239541-84",
          "239603-84",
          "242928-84",
          "242940-84",
          "242951-84",
          "247303-84",
          "247549-84",
          "247616-84",
          "247700-84",
          "254570-84",
          "255357-84",
          "256338-84",
          "261394-84",
          "261592-84",
          "120274-172",
          "220739-143",
          "262271-172",
          "200104-3",
          "201942-30",
          "202126-3",
          "231281-11",
          "206113-11",
          "213874-173",
          "215698-11",
          "216320-11",
          "232363-11",
          "234378-11",
          "236786-11",
          "241852-11",
          "120533-173",
          "165153-64",
          "167948-137",
          "182521-30",
          "184200-173",
          "198219-137",
          "203574-136",
          "203747-173",
          "208418-11",
          "209440-11",
          "216547-11",
          "224334-11",
          "227055-136",
          "232905-11",
          "241461-71",
          "241771-11",
          "251470-11",
          "253163-11",
          "27-172",
          "189511-137",
          "198717-11",
          "202556-125",
          "229158-11",
          "236403-11",
          "239231-173",
          "330-172",
          "159261-137",
          "215061-143",
          "6975-172",
          "16619-172",
          "186627-11",
          "205953-11",
          "226166-173",
          "205119-143",
          "261593-173",
          "199914-30",
          "224458-11",
          "240273-71",
          "201024-96",
          "209297-11",
          "233049-30",
          "235790-124",
          "247819-11",
          "253149-11",
          "41236-118",
          "183898-107",
          "185068-11",
          "185195-11",
          "188377-124",
          "189575-11",
          "190815-173",
          "197655-11",
          "222716-173",
          "236496-11",
          "237646-11",
          "243715-11",
          "255475-11",
          "139068-134",
          "193747-137",
          "194017-11",
          "216460-136",
          "248243-136",
          "524-173",
          "49486-11",
          "212591-11",
          "191043-136",
          "222331-136",
          "205452-64",
          "212188-50",
          "241084-96",
          "198329-136",
          "207865-50",
          "209658-64",
          "212419-137",
          "224232-96",
          "230621-70",
          "231866-11",
          "233927-30",
          "239085-22",
          "239093-11",
          "239580-11",
          "246646-11",
          "252145-30",
          "195864-118",
          "200145-22",
          "202652-118",
          "205585-11",
          "208093-11",
          "210315-11",
          "214047-11",
          "216594-30",
          "216813-11",
          "225085-136",
          "233301-11",
          "244067-71",
          "251805-11",
          "177003-118",
          "177388-137",
          "208574-11",
          "211506-11",
          "216201-136",
          "226161-124",
          "235844-136",
          "242444-107",
          "236703-11",
          "224885-11",
          "230969-11",
          "232646-11",
          "262929-11",
          "189505-136",
          "214990-143",
          "216476-143",
          "222665-30",
          "231281-70",
          "232656-3",
          "234642-64",
          "237678-71",
          "238074-96",
          "155862-21",
          "206517-30",
          "209499-118",
          "209519-96",
          "217870-30",
          "220793-30",
          "221363-134",
          "241721-96",
          "245940-30",
          "184941-124",
          "202048-11",
          "210035-11",
          "210648-11",
          "213345-118",
          "216816-96",
          "228702-50",
          "230666-116",
          "233500-11",
          "238794-96",
          "242554-11",
          "243576-71",
          "246785-71",
          "256197-136",
          "172871-136",
          "200588-11",
          "210044-11",
          "225193-136",
          "183394-136",
          "186153-3",
          "204320-11",
          "235805-64",
          "168435-136",
          "223690-143",
          "235511-143",
          "220018-30",
          "224458-107",
          "226790-30",
          "241202-71",
          "245388-11",
          "183512-30",
          "200949-118",
          "211300-118",
          "215698-118",
          "233267-11",
          "240243-71",
          "183277-118",
          "183540-11",
          "202562-136",
          "205054-11",
          "212442-136",
          "240987-11",
          "198706-3",
          "215785-136",
          "216258-30",
          "224396-11",
          "225375-30",
          "232411-70",
          "223848-118",
          "228415-143",
          "231093-143",
          "207862-3",
          "213661-70",
          "184432-118",
          "209889-30",
          "229558-21",
          "230938-22",
          "243630-64",
          "146536-50",
          "189271-30",
          "199451-110",
          "230767-124",
          "240754-134",
          "243812-50",
          "244778-71",
          "199833-11",
          "212212-136",
          "215399-30",
          "232730-30",
          "239053-116",
          "240130-107",
          "241486-108",
          "252042-71",
          "210935-3",
          "184344-64",
          "223959-30",
          "202884-118",
          "180930-3",
          "205988-3",
          "210324-3",
          "216393-3",
          "201535-21",
          "212219-30",
          "215330-21",
          "225100-116",
          "226491-118",
          "233096-21",
          "246420-30",
          "194765-21",
          "232119-118",
          "243630-118",
          "251573-50",
          "255475-70",
          "179605-118",
          "204838-110",
          "213956-108",
          "214997-108",
          "219953-118",
          "227928-118",
          "236496-118",
          "241464-118",
          "241788-118",
          "204638-8",
          "208448-8",
          "216475-118",
          "184575-118",
          "234035-134",
          "197061-3",
          "224179-8",
          "231485-118",
          "252339-70",
          "200536-116",
          "203551-118",
          "203741-118",
          "222357-118",
          "240754-110",
          "256500-118",
          "210625-108",
          "217036-118",
          "219693-110",
          "225859-118",
          "231416-118",
          "245211-118",
          "199845-3",
          "213013-118",
          "189250-8",
          "224411-8",
          "202799-118",
          "203843-3",
          "236477-116",
          "235374-3",
          "226754-3",
          "162347-3",
          "209430-22",
          "239125-104",
          "202648-3"
        ];

  document.unclaim_mode = false;


  document.importing_link = false;

  let playerIdentity = window.location.search.substr(1);
  if(playerIdentity.substr(0, 5) === "link="){
    document.importing_link = playerIdentity.substr(5);
    playerIdentity = "";
  }


  document.futtiescollector = true;

  document.futties_collected = 0;

  document.tokens_expired = 0;

  document.missed = 0;

  let tokens_number = 0;

  document.missinghidden = false;

  document.max_futties = cardArray.length;

  $(document).ready(function () {

    $("#legend_wrapper").click(function () {
      $(this).hide();
      localStorage.setItem("legend_hidden", "true");
      $("#show_legend").css("display", "flex");
    });

    $("#show_legend").click(function () {
      $(this).hide();
      localStorage.setItem("legend_hidden", "false");
      $("#legend_wrapper").show();
    });

    $("#export_link").click(function () {
             
        let string = "";
        cardArray.forEach(function (card, index) {
          if(document.claimed_futties.includes(card)){
            string = string + 1;
          } else {
            string = string + 0;
          }
        });

        let converted = convertBase(string, 2, 64);
        
        alert("https://freakpants.github.io/collector/?link=" + converted);
        document.location = "https://freakpants.github.io/collector/?link=" + converted;
    });

    $(".reset").click(function () {
      if (document.futtiescollector) {

        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify([]));
        } else {
          localStorage.setItem("document.claimed_futties", JSON.stringify([]));
        }
      } else {
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify([]));
        } else {
          localStorage.setItem("document.claimed_tokens", JSON.stringify([]));
        }
      }

      location.reload();
    }
    );

    $(".unclaim").click(function () {
      if (document.unclaim_mode == true) {
        document.unclaim_mode = false;
        $(".unclaim").removeClass("mode-active");
      } else {
        document.unclaim_mode = true;
        $(".unclaim").addClass("mode-active");
      }
    }
    );

    $(".print").click(function () {
      $("#tokens").print({ stylesheet: "print.css" });
    }
    );

    $("#rewards").click(function () {
      location.href = "https://i.redd.it/mue2mtnphje91.png";
    }
    );

    $("#docs").click(function () {
      location.href = "https://github.com/freakpants/tokens/blob/main/README.md";
    }
    );
  });

  $("#search").on('input', function (e) {
    let string = $(e.target).val();
    $('.marquee:not(:contains(' + string + '))').closest('.card').hide();
    $('.marquee:contains(' + string + ')').closest('.card.hidden-by-search').show();
    $('.marquee:not(:contains(' + string + '))').closest('.card').addClass("hidden-by-search");
    // set batch to everything
    $("#batch_select").val("all");
    display_filters();
    $("#togglemissing").prop("checked", false);
    update_futties_counter();
  });

  function update_token_count() {
    let expired_tokens_done = $(".expired.token-claimed").length;
    $("#claimed").text(document.claimed_tokens.length + "/" + document.available_tokens);
    $("#expired").text(document.tokens_expired);
    $("#missed").text(document.missed - expired_tokens_done);
    $("#max").text(50 - document.missed + expired_tokens_done);
  }

  function update_futties_counter() {
    $("#collected").text($("#tokens .token-claimed.card:visible").length + "/" + $("#tokens .card:visible").length);
    $("#displaying").text($("#tokens .card:visible").length + "/" + document.max_futties);
  }

  function fade_in_promo(promo) {
    const batch = $("#batch_select").val();
    const selector = get_batch_selector(batch);
    if (batch === "futties_123") {
      $(".card" + promo + "[data-futties-1]:not(.unavailable)").fadeIn(update_futties_counter);
      $(".card" + promo + "[data-futties-2]:not(.unavailable)").fadeIn(update_futties_counter);
      $(".card" + promo + "[data-futties-3]:not(.unavailable)").fadeIn(update_futties_counter);
    } else {
      $(".card" + promo + selector + ":not(.unavailable)").fadeIn(update_futties_counter);
    }
  }

  function display_filters() {
    const batch = $("#batch_select").val();
    // hide all specific filter checkboxes
    $("#checkbox_wrapper input").hide();
    $("#checkbox_wrapper label").hide();
    // show the toggle all
    $("#toggleall").show();
    $("[for=toggleall]").show();
    switch (batch) {
      case "ss_pp":
        show_checkbox("shapeshifters");
        break;
      case "icons":
        show_checkbox("icons");
        break;
      case "all":
        $("#checkbox_wrapper input").show();
        $("#checkbox_wrapper label").show();
        break;
      case "preseason_1":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("libertadores");
        break;
      case "preseason_2":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("uefa");
        show_checkbox("captains");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        break;
      case "futties_1":
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
        break;
      case "futties_2":
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
        break;
      case "futties_3":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("totw");
        show_checkbox("motm");
        break;
      case "futties_123":
        show_checkbox("shapeshifters");
        show_checkbox("tots");
        show_checkbox("toty");
        show_checkbox("fantasy");
        show_checkbox("captains");
        show_checkbox("uefa");
        show_checkbox("birthday");
        show_checkbox("futurestars");
        show_checkbox("wildcard");
        show_checkbox("headliners");
        show_checkbox("signature");
        show_checkbox("totw");
        show_checkbox("numbersup");
        show_checkbox("honourable");
        show_checkbox("halloween");
        show_checkbox("otw");
        show_checkbox("versus");
        show_checkbox("motm");
        show_checkbox("captains");
        show_checkbox("shapeshifters");
        break;
      case "campaign":
        show_checkbox("fantasy");
        show_checkbox("birthday");
        show_checkbox("wildcard");
        break;
    }
  }

  function show_checkbox(promo) {
    $("#" + promo).show();
    $("[for=" + promo + "]").show();
  }

  function mark_tokens() {
    document.claimed_tokens = '';
    document.claimed_futties = '';
    if (document.futtiescollector) {
      if (playerIdentity !== '') {
        document.claimed_futties = localStorage.getItem('document.claimed_futties' + playerIdentity);
      } else {

        if(document.importing_link){
          let converted = convertBase(document.importing_link, 64, 2);
          if(converted.length !== cardArray.length){
            converted = converted.padStart(cardArray.length, '0');
          }
          document.claimed_futties = [];
          for(i = 0; i < converted.length; i++){
             if(converted[i] === '1'){
              document.claimed_futties.push(cardArray[i]);
            } 
          } 
          document.claimed_futties = JSON.stringify(document.claimed_futties);

        } else {
          document.claimed_futties = localStorage.getItem('document.claimed_futties');
        }
      }

      if (document.claimed_futties == null) {
        document.claimed_futties = [];
      } else {
        document.claimed_futties = JSON.parse(document.claimed_futties);

      }
      document.claimed_futties.forEach(function (token) {
        const parts = token.split('-');
        $('div[data-base-id="' + parts[0] + '"][data-rarity-id="' + parts[1] + '"]').addClass('token-claimed');
      });
      update_futties_counter();

    } else {
      if (playerIdentity !== '') {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens' + playerIdentity);
      } else {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens');
      }

      if (document.claimed_tokens == null) {
        document.claimed_tokens = [];
        document.claimed_tokens.push(166847);
      } else {
        document.claimed_tokens = JSON.parse(document.claimed_tokens);
      }

      document.claimed_tokens.forEach(function (token) {
        $('div[data-base-id="' + token + '"]').addClass('token-claimed');
      });

      update_token_count();

    }


  }



  // add data counter to each card
  // $('#tokens > div').each(function(index) {
  //   $(this).attr('data-token-id', index + 1);
  // });

  function get_batch_selector(batch) {
    switch (batch) {
      case "ss_pp":
        selector = "[data-shapeshifters-pick=1]";
        break;
      case "icons":
        selector = "[data-rareflag=84]";
        break;
      case "all":
        selector = ".card";
        break;
      case "preseason_1":
        selector = "[data-preseason-1=1]";
        break;
      case "preseason_2":
        selector = "[data-preseason-2=1]";
        break;
      case "futties_1":
        selector = "[data-futties-1=1]";
        break;
      case "futties_2":
        selector = "[data-futties-2=1]";
        break;
      case "futties_3":
        selector = "[data-futties-3=1]";
        break;
      case "futties_123":
        selector = "[data-futties-1=1],[data-futties-2=1],[data-futties-3=1]";
        break;
      case "campaign":
        selector = "[data-campaign-bag=1]";
        break;
    }
    return selector;
  }

  function add_darken_class() {
    $('#tokens div').each(function (index) {
      // if this has class token_source, dont darken
      if (!$(this).hasClass('card') && !$(this).hasClass('token_source') && !$(this).hasClass('token_objective') && !$(this).hasClass('token_objective_wrapper') && !$(this).hasClass('attributes')) {
        $(this).addClass('darken');
      }
    });
  }

  function card_click(parent) {
    if ($(parent).hasClass('inactive') || document.importing_link) {
      return;
    }
    if ($(parent).hasClass('token-claimed')) {
      if (document.unclaim_mode == true) {
        console.log("removing token-claimed class");
        $(parent).removeClass("token-claimed");
        let token_id = $(this).data('base-id');

        if (document.futtiescollector) {
          token_id = $(this).data('base-id') + "-" + $(this).data('rarity-id');
          let index = document.claimed_futties.indexOf(token_id);
          document.claimed_futties.splice(index, 1);
          if (playerIdentity !== '') {
            localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify(document.claimed_futties));
          } else {
            localStorage.setItem("document.claimed_futties", JSON.stringify(document.claimed_futties));
          }
          update_futties_counter();
        } else {
          let index = document.claimed_tokens.indexOf(token_id);
          document.claimed_tokens.splice(index, 1);
          if (playerIdentity !== '') {
            localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
          } else {
            localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
          }
          update_token_count();
        }


        return;
      } else {
        console.log("doing nothing because unclaim mode is false");
        return;
      }
    }

    if (!document.unclaim_mode) {
      $(parent).addClass('token-claimed');

      if (document.futtiescollector) {
        document.claimed_futties.push($(parent).data('base-id') + "-" + $(parent).data('rarity-id'));
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_futties" + playerIdentity, JSON.stringify(document.claimed_futties));
        } else {
          localStorage.setItem("document.claimed_futties", JSON.stringify(document.claimed_futties));
        }
        update_futties_counter();
      } else {
        document.claimed_tokens.push($(parent).data('base-id'));
        if (playerIdentity !== '') {
          localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
        } else {
          localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
        }
        update_token_count();
      }
    }

  }

  function convertBase(str, fromBase, toBase) {

    const DIGITS = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/";

    const add = (x, y, base) => {
      let z = [];
      const n = Math.max(x.length, y.length);
      let carry = 0;
      let i = 0;
      while (i < n || carry) {
        const xi = i < x.length ? x[i] : 0;
        const yi = i < y.length ? y[i] : 0;
        const zi = carry + xi + yi;
        z.push(zi % base);
        carry = Math.floor(zi / base);
        i++;
      }
      return z;
    }

    const multiplyByNumber = (num, x, base) => {
      if (num < 0) return null;
      if (num == 0) return [];

      let result = [];
      let power = x;
      while (true) {
        num & 1 && (result = add(result, power, base));
        num = num >> 1;
        if (num === 0) break;
        power = add(power, power, base);
      }

      return result;
    }

    const parseToDigitsArray = (str, base) => {
      const digits = str.split('');
      let arr = [];
      for (let i = digits.length - 1; i >= 0; i--) {
        const n = DIGITS.indexOf(digits[i])
        if (n == -1) return null;
        arr.push(n);
      }
      return arr;
    }

    const digits = parseToDigitsArray(str, fromBase);
    if (digits === null) return null;

    let outArray = [];
    let power = [1];
    for (let i = 0; i < digits.length; i++) {
      digits[i] && (outArray = add(outArray, multiplyByNumber(digits[i], power, toBase), toBase));
      power = multiplyByNumber(fromBase, power, toBase);
    }

    let out = '';
    for (let i = outArray.length - 1; i >= 0; i--)
      out += DIGITS[outArray[i]];

    return out;
  }

  function name_copy(event) {
    const id = $(event.target).data("base-id");
    var copyTextarea = document.querySelector('[data-type="name"][data-base-id="' + id + '"]');
    console.log(copyTextarea);

    $(copyTextarea).parent().show();

    copyTextarea.type = "text";
    copyTextarea.focus();
    copyTextarea.select();
    document.execCommand("copy");
    $(copyTextarea).parent().hide();
    copyTextarea.type = "hidden";
    event.stopPropagation();
  }

  if (document.futtiescollector) {
    enable_futties();
  } else {
    ajax({
      url: "https://freakpants.github.io/tokens/tokens.json",
    }).done(function (result) {
      console.log(result);
      result.forEach(function (player) {
        $('#tokens').append(player);
        tokens_number++;

      });



      // remember how many tokens are available
      document.available_tokens = tokens_number;
      // generate the rest of the empty divs
      for (let i = tokens_number; i < 50; i++) {
        $('#tokens').append(`
      <div class="card bronze fifa22 inactive" data-base-id="" data-club-id="1929" data-nation-id="14" data-league-id="60" data-rareflag="0">
          <div class="token_number">${i + 1}</div>
          <div class="scard bronze fifa22 style="position: relative; z-index: 2">

              <img src="token.png" alt="" class="player-card">
  
              <div class="rating-gradient"></div>

              
              <div class="avatarholder ">
                  </div>
  
        
              

          </div>
      </div>
      </div>
      `);
      }
      mark_tokens();
      add_darken_class();
      $('#tokens .card.fifa22').click(function () {
        const element = $(this);
        card_click(element);
      });




      $(".marquee").click(function (event) {
        name_copy(event);
      });

      $("#futties").click(function () {
        enable_futties();
      }
      );

      $("#objectives").click(function () {
        if (this.checked) {
          $("[data-type='objective']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='objective']").closest(".fifa22.card").fadeOut();
        }
      });

      $("#sbc").click(function () {
        if (this.checked) {
          $("[data-type='sbc']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='sbc']").closest(".fifa22.card").fadeOut();
        }
      });

      $("#packs").click(function () {
        if (this.checked) {
          $("[data-type='pack']").closest(".fifa22.card").fadeIn();
        } else {
          $("[data-type='pack']").closest(".fifa22.card").fadeOut();
        }
      });

      $(".token_objective_wrapper").each(function (index) {
        const timeStamp = $(this).attr('data-timestamp');
        if (timeStamp == 0) {
          return;
        }
        const timeLeft = timeStamp - (Math.floor(Date.now() / 1000));
        if (timeLeft < 0) {
          document.tokens_expired++;
          document.missed++;
          const closest = $(this).closest(".card.fifa22");
          $(closest).addClass("expired");
          $(closest).find(".token_objective_wrapper").addClass("expired");
          $(closest).find(".token_objective").html("EXPIRED");
          return;
        }
        const timeLeftDays = Math.floor(timeLeft / 86400);
        if (timeLeftDays <= 2) {
          const timeLeftHours = Math.floor(timeLeft / 3600);
          $(this).find(".token_objective").append('<b> (' + timeLeftHours + 'H)</b>');
        }
        if (timeLeftDays == 0) {
          $(this).closest(".card.fifa22").addClass("warning");
        }
      }
      );
      update_token_count();

    });
  }

  function update_batches(trigger) {
    // fade out all
    $(".card.fifa22").fadeOut();
    switch (trigger) {
      case "futties_1":
        $(".card.fifa22[data-futties-1='1']").fadeIn(update_futties_counter);
        break;
      case "futties_2":
        $(".card.fifa22[data-futties-2='1']").fadeIn(update_futties_counter);
        break;
      case "futties_3":
        $(".card.fifa22[data-futties-3='1']").fadeIn(update_futties_counter);
        break;
      case "futties_123":
        // fade in all cards that have at least one futties
        $("[data-futties-1='1'],[data-futties-2='1'],[data-futties-3='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
      case "ss_pp":
        $("[data-shapeshifters-pick='1']").fadeIn(update_futties_counter);
        break;
      case "preseason_1":
        $("[data-preseason-1='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
      case "all":
        $(".card.fifa22:not(.unavailable)").fadeIn(update_futties_counter);
        break;
      case "icons":
        $("[data-rareflag='84']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
      case "preseason_2":
        $("[data-preseason-2='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
      case "campaign":
        $("[data-campaign-bag='1']").closest(".card.fifa22").fadeIn(update_futties_counter);
        break;
    }
  }

  function enable_futties() {
    document.futtiescollector = true;
    let player_number = 0;
    $("#criminal").hide();
    $("#tokens").html("");
    $("body").addClass("futties");
    $(".header").hide();
    $(".futties-header").show();
    $("#overlay_bg").show();

    // add futties class to token div
    $('#tokens').addClass('futties');
    $.ajax({
      url: "https://freakpants.github.io/collector/players.json",
    }).done(function (result) {
      console.log();
      result.forEach(function (player) {
        $('#tokens').append(player);
        player_number++;


      });
      // bind the click events again
      $(".marquee").click(function (event) {
        name_copy(event);
      });
      $('#tokens .card.fifa22').click(function () {
        const element = $(this);
        card_click(element);
      });

      add_darken_class();

      mark_tokens();

      $("#shapeshifters").click(function () {
        if (this.checked) {
          fade_in_promo(".shapeshifters");
        } else {
          $(".card.shapeshifters").fadeOut(update_futties_counter);
        }

      });

      $("#tots").click(function () {
        if (this.checked) {
          fade_in_promo(".goldblue");
        } else {
          $(".card.goldblue").fadeOut(update_futties_counter);
        }
      });

      $("#toty").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=5]");
        } else {
          $("[data-rareflag=5]").fadeOut(update_futties_counter);
        }
      });


      $("#fantasy").click(function () {
        if (this.checked) {
          fade_in_promo(".fantasypurple");
          fade_in_promo(".fantasyblue");
        } else {
          $(".card.fantasypurple").fadeOut(update_futties_counter);
          $(".card.fantasyblue").fadeOut(update_futties_counter);
        }
      });

      $("#icons").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=84]");
        } else {
          $("[data-rareflag=84]").fadeOut(update_futties_counter);
        }
      });

      $("#uefa").click(function () {
        if (this.checked) {
          fade_in_promo(".championsleague");
          fade_in_promo(".elfinal");
          fade_in_promo(".clfinal");
          fade_in_promo(".promo");
          fade_in_promo(".confleague");
        } else {
          $(".card.championsleague").fadeOut(update_futties_counter);
          $(".card.elfinal").fadeOut(update_futties_counter);
          $(".card.clfinal").fadeOut(update_futties_counter);
          $(".card.promo").fadeOut(update_futties_counter);
          $(".card.confleague").fadeOut(update_futties_counter);
        }
      });

      $("#headliners").click(function () {
        if (this.checked) {
          fade_in_promo(".futheadliners");
        } else {
          $(".card.futheadliners").fadeOut(update_futties_counter);
        }
      });

      $("#captains").click(function () {
        if (this.checked) {
          fade_in_promo(".futcaptains");
          fade_in_promo(".futcaptainsheroes");
        } else {
          $(".card.futcaptains").fadeOut(update_futties_counter);
          $(".card.futcaptainsheroes").fadeOut(update_futties_counter);
        }
      });

      $("#birthday").click(function () {
        if (this.checked) {
          fade_in_promo(".birthday");
        } else {
          $(".card.birthday").fadeOut(update_futties_counter);
        }
      });

      $("#otw").click(function () {
        if (this.checked) {
          fade_in_promo(".onestowatch");
        } else {
          $(".card.onestowatch").fadeOut(update_futties_counter);
        }
      });

      $("#wildcard").click(function () {
        if (this.checked) {
          fade_in_promo(".wildcard");
        } else {
          $(".card.wildcard").fadeOut(update_futties_counter);
        }
      });

      $("#signature").click(function () {
        if (this.checked) {
          fade_in_promo(".signature");
        } else {
          $(".card.signature").fadeOut(update_futties_counter);
        }
      });

      $("#numbersup").click(function () {
        if (this.checked) {
          fade_in_promo(".numbersup");
        } else {
          $(".card.numbersup").fadeOut(update_futties_counter);
        }
      });

      $("#halloween").click(function () {
        if (this.checked) {
          fade_in_promo(".halloween");
        } else {
          $(".card.halloween").fadeOut(update_futties_counter);
        }
      });

      // toggle future stars
      $("#futurestars").click(function () {
        if (this.checked) {
          fade_in_promo(".futurestars");
        } else {
          $(".card.futurestars").fadeOut(update_futties_counter);
        }
      });

      // toggle totw
      $("#totw").click(function () {
        if (this.checked) {
          fade_in_promo(".goldif");
        } else {
          $(".card.goldif").fadeOut(update_futties_counter);
        }
      });

      // toggle versus 
      $("#versus").click(function () {
        if (this.checked) {
          fade_in_promo(".versusice");
          fade_in_promo(".versusfire");
        } else {
          $(".card.versusfire").fadeOut(update_futties_counter);
          $(".card.versusice").fadeOut(update_futties_counter);
        }
      });

      // toggle motm
      $("#motm").click(function () {
        if (this.checked) {
          fade_in_promo(".motm");
        } else {
          $(".card.motm").fadeOut(update_futties_counter);
        }
      });

      // toggle toty honourable mentions
      $("#honourable").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=64]");
        } else {
          $("[data-rareflag=64]").fadeOut(update_futties_counter);
        }
      });

      // toggle libertadores
      $("#libertadores").click(function () {
        if (this.checked) {
          fade_in_promo("[data-rareflag=143]");
        } else {
          $("[data-rareflag=143]").fadeOut(update_futties_counter);
        }
      });

      $("#togglesource").click(function () {
        if (!this.checked) {
          $(".token-claimed .token_number").show();
        } else {
          $(".token-claimed .token_number").hide();
        }
      });

      $("#togglemissing").click(function () {
        if (!this.checked) {
          document.missinghidden = false;
          $(".unavailable").each(function () {
            $(this).fadeIn(update_futties_counter);
            $(this).removeClass("unavailable");
          });

          /* 
                  <option selected value="preseason_2">Preseason 2 (5)</option>
        <option value="futties_123">Futties 1-3 PP</option>
        <option value="campaign">Campaign Bag PP (6)</option>
        <option value="ss_pp">Shapeshifters PP (7)</option>
        <option value="icons">93+ Icon Moments PP (8)</option>
        <option value="preseason_1">Preseason 1 (4)</option>
        <option value="futties_3">Futties 3 (3)</option>
        <option value="futties_2">Futties 2 (2)</option>
        <option value="futties_1">Futties 1 (1)</option>
        <option value="all">Everything</option> */

          $('#batch_select').append($('<option>', {
            value: "futties_123",
            text: 'Futties 1-3 PP'
          }));
          $('#batch_select').append($('<option>', {
            value: "futties_3",
            text: 'Futties 3 (3)'
          }));
          $('#batch_select').append($('<option>', {
            value: "futties_2",
            text: 'Futties 2 (2)'
          }));
          $('#batch_select').append($('<option>', {
            value: "futties_1",
            text: 'Futties 1 (1)'
          }));
          $('#batch_select').append($('<option>', {
            value: "preseason_1",
            text: 'Preseason 1 (4)'
          }));
          $('#batch_select').append($('<option>', {
            value: "campaign",
            text: 'Campaign Bag PP (6)'
          }));

          document.max_futties = cardArray.length;
        } else {
          document.missinghidden = true;
          document.max_futties = 373;

          $("#batch_select option[value='futties_1']").remove();
          $("#batch_select option[value='futties_2']").remove();
          $("#batch_select option[value='futties_3']").remove();
          $("#batch_select option[value='futties_123']").remove();
          $("#batch_select option[value='preseason_1']").remove();
          $("#batch_select option[value='campaign']").remove();

          // hide every card from unavailable batches
          $("[data-futties-1=1],[data-futties-2=1],[data-futties-3=1],[data-preseason-1=1],[data-campaign-bag=1]").each(function () {
            $(this).addClass("unavailable");
            $(this).fadeOut();
          });

          // then show cards from available batches again
          $("[data-preseason-1=1],[data-shapeshifters-pick=1],[data-preseason-2=1],.legend").each(function () {
            $(this).removeClass("unavailable");
            $(this).fadeIn(update_futties_counter);
          });
        }
        // set batch to everything
        $("#batch_select").val("all");
        display_filters();
      });

      $("#batch_select").change((e) => {
        const batch = e.target.value;
        update_batches(batch);
        display_filters();
        // check all filter checkboxes
        $(".checkbox_wrapper_futties input").prop("checked", true);
      });

      // toggle all cards
      $("#toggleall").click(function () {
        if (this.checked) {
          const batch = $("#batch_select").val();
          const selector = get_batch_selector(batch);

          $(selector).fadeIn(update_futties_counter);
          $(".checkbox_wrapper_futties input").each(function () {
            $(this).prop("checked", true);
          });

        } else {
          $(".card").fadeOut(update_futties_counter);
          // uncheck all checkboxes in the checkbox_wrapper_futties
          $(".checkbox_wrapper_futties input").each(function () {
            $(this).prop("checked", false);
          });
        }

      });

      // lower case all names
      $(".marquee").each(function () {
        $(this).text($(this).text().toLowerCase());
      });

      $("#togglebatch1").prop("checked", false);
      $("#togglebatch2").prop("checked", false);
      $("#togglebatch3").prop("checked", false);
      // hide all cards
      $(".card").hide();
      // show all cards that are in the current batch
      $("[data-preseason-2]").show();
      display_filters();
      update_futties_counter();

      if (localStorage.getItem("legend_hidden") === null || localStorage.getItem("legend_hidden") === "false") {
        $("#legend_wrapper").css("display", "flex");
      } else {
        $("#show_legend").css("display", "flex");
      }

      // remove the html in all token numbers
      $('.token_number').remove();
      $("[data-futties-1]").append("<div class='token_number tooltip unavailable'>1<span class='tooltiptext'>Futties Batch 1 (unavailable)</span></div>");
      $("[data-futties-2]").append("<div class='token_number tooltip unavailable'>2<span class='tooltiptext'>Futties Batch 2 (unavailable)</span></div>");
      $("[data-futties-3]").append("<div class='token_number tooltip unavailable'>3<span class='tooltiptext'>Futties Batch 3 (unavailable)</span></div>");
      $("[data-preseason-1]").append("<div class='token_number tooltip unavailable'>4<span class='tooltiptext'>Preseason Batch 1 (unavailable)</span></div>");
      $("[data-preseason-2]").append("<div class='token_number tooltip'>5<span class='tooltiptext'>Preseason Batch 2 (in Packs until Sep 23)</span></div>");
      $("[data-campaign-bag]").append("<div class='token_number tooltip unavailable'>6<span class='tooltiptext'>Campaign Bag PP</span></div>");
      $("[data-shapeshifters-pick]").append("<div class='token_number tooltip'>7<span class='tooltiptext'>Shapeshifter PP</span></div>");
      $("[data-rareflag=84]").append("<div class='token_number tooltip'>8<span class='tooltiptext'>93+ Icon Moments PP</span></div>");
      /* 
        $(this).html("");
        if (typeof $(this).parent().data('futties-1') !== 'undefined') {
          $(this).html("1");
        }
        if (typeof $(this).parent().data('futties-2') !== 'undefined') {
          $(this).append("2");
        }
        if (typeof $(this).parent().data('futties-3') !== 'undefined') {
          $(this).append("3");
        }
  
      }); */

    });
    $("#counters").hide();
  }

</script>

</html>