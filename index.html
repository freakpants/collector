<!doctype html>
<html>

<head>
  <title>Summer Swaps 2 Token Tracker</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="css.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Secular+One">
</head>

<body>
  <div id="overlay_bg"></div>
  <div class="futties-header">
    <h1>Futties Collector</h1>
    <button id="reset" class="btn-standard call-to-action">
      <span class="button__text">Reset</span>
    </button>
  </div>
  <div class="header">
    <h1>Summer Swaps 2</h1>
    <h2>Token Tracker</h2>
    <div id="attribution">
      <h3 id="docs">?</h3>
    </div>
    <div id="button-wrapper">
      <button id="unclaim" class="btn-standard call-to-action">
        <span class="button__text">Unclaim tokens</span>
      </button>
      <button id="reset" class="btn-standard call-to-action">
        <span class="button__text">Reset all claimed tokens</span>
      </button>
      <button id="rewards" class="btn-standard call-to-action">
        <span class="button__text">Rewards</span>
      </button>
      <button id="futties" class="btn-standard call-to-action">
        <span class="button__text">Futties Collector</span>
      </button>
      <div>
        <div>
          <input type="checkbox" id="sbc" name="sbc" checked>
          <label for="sbc">SBC's</label>
        </div>
        <div>
          <input type="checkbox" id="objectives" name="objectives" checked>
          <label for="objectives">Objectives</label>
        </div>
        <div>
          <input type="checkbox" id="packs" name="packs" checked>
          <label for="packs">Packs</label>
        </div>
      </div>
    </div>


  </div>
  <div id="tokens"></div>
</body>
<script>

  document.unclaim_mode = false;

  const playerIdentity = window.location.search.substr(1);

  document.futtiescollector = false;

  document.futties_collected = 0;

  let tokens_number = 0;

  function mark_tokens() {
      document.claimed_tokens = '';
      if (playerIdentity !== '') {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens' + playerIdentity);
      } else {
        document.claimed_tokens = localStorage.getItem('document.claimed_tokens');
      }

      if (document.claimed_tokens == null) {
        document.claimed_tokens = [];
        document.claimed_tokens.push(166847);
      } else {
        document.claimed_tokens = JSON.parse(document.claimed_tokens);
      }

      document.claimed_tokens.forEach(function (token) {
        $('div[data-base-id="' + token + '"]').addClass('token-claimed');
      });
    }



    // add data counter to each card
    // $('#tokens > div').each(function(index) {
    //   $(this).attr('data-token-id', index + 1);
    // });

    

    function add_darken_class() {
      $('#tokens div').each(function (index) {
        // if this has class token_source, dont darken
        if (!$(this).hasClass('token_source') && !$(this).hasClass('token_objective') && !$(this).hasClass('token_objective_wrapper') && !$(this).hasClass('attributes')) {
          $(this).addClass('darken');
        }
      });
    }

    function card_click(parent) {
      if ($(parent).hasClass('inactive')) {
        return;
      }
      if ($(parent).hasClass('token-claimed')) {
        if (document.unclaim_mode == true) {
          console.log("removing token-claimed class");
          $(parent).removeClass("token-claimed");
          let token_id = $(this).data('base-id');
          let index = document.claimed_tokens.indexOf(token_id);
          document.claimed_tokens.splice(index, 1);
          if (playerIdentity !== '') {
            localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
          } else {
            localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
          }

          return;
        } else {
          console.log("doing nothing because unclaim mode is false");
          return;
        }
      }
      $(parent).addClass('token-claimed');
      document.claimed_tokens.push($(parent).data('base-id'));
      if (playerIdentity !== '') {
        localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify(document.claimed_tokens));
      } else {
        localStorage.setItem("document.claimed_tokens", JSON.stringify(document.claimed_tokens));
      }
    }

    

    function name_copy(event) {
      const id = $(event.target).data("base-id");
      var copyTextarea = document.querySelector('[data-type="name"][data-base-id="' + id + '"]');
      console.log(copyTextarea);

      $(copyTextarea).parent().show();

      copyTextarea.type = "text";
      copyTextarea.focus();
      copyTextarea.select();
      document.execCommand("copy");
      $(copyTextarea).parent().hide();
      copyTextarea.type = "hidden";
      event.stopPropagation();
    }

  $.ajax({
    url: "https://freakpants.github.io/tokens/tokens.json",
  }).done(function (result) {
    console.log(result);
    result.forEach(function (player) {
      $('#tokens').append(player);
      tokens_number++;
      
    });
    // generate the rest of the empty divs
    for (let i = tokens_number; i < 50; i++) {
      $('#tokens').append(`
      <div class="card bronze fifa22 inactive" data-base-id="" data-club-id="1929" data-nation-id="14" data-league-id="60" data-rareflag="0">
          <div class="token_number">${i + 1}</div>
          <div class="scard bronze fifa22 style="position: relative; z-index: 2">

              <img src="token.png" alt="" class="player-card">
  
              <div class="rating-gradient"></div>

              
              <div class="avatarholder ">
                  </div>
  
        
              

          </div>
      </div>
      </div>
      `);
    }
    mark_tokens();
    add_darken_class();
    $('#tokens .card.fifa22').click(function () {
      const element = $(this);
      card_click(element);
    });
    $("#reset").click(function () {
      if (playerIdentity !== '') {
        localStorage.setItem("document.claimed_tokens" + playerIdentity, JSON.stringify([]));
      } else {
        localStorage.setItem("document.claimed_tokens", JSON.stringify([]));
      }
      location.reload();
    }
    );

    $("#unclaim").click(function () {
      if (document.unclaim_mode == true) {
        document.unclaim_mode = false;
        $("#unclaim").removeClass("mode-active");
      } else {
        document.unclaim_mode = true;
        $("#unclaim").addClass("mode-active");
      }
    }
    );

    $("#rewards").click(function () {
      location.href = "https://pbs.twimg.com/media/FYrZ_Q5WYAAKwr0?format=jpg&name=900x900";
    }
    );

    $("#docs").click(function () {
      location.href = "https://github.com/freakpants/tokens/blob/main/README.md";
    }
    );
    $(".marquee").click(function (event) {
      name_copy(event);
    });

    $("#futties").click(function () {
      enable_futties();
    }
    );

    $("#objectives").click(function () {
      if (this.checked) {
        $("[data-type='objective']").closest(".fifa22.card").fadeIn();
      } else {
        $("[data-type='objective']").closest(".fifa22.card").fadeOut();
      }
    });

    $("#sbc").click(function () {
      if (this.checked) {
        $("[data-type='sbc']").closest(".fifa22.card").fadeIn();
      } else {
        $("[data-type='sbc']").closest(".fifa22.card").fadeOut();
      }
    });

    $("#packs").click(function () {
      if (this.checked) {
        $("[data-type='pack']").closest(".fifa22.card").fadeIn();
      } else {
        $("[data-type='pack']").closest(".fifa22.card").fadeOut();
      }
    });

    $(".token_objective_wrapper").each(function (index) {
      const timeStamp = $(this).attr('data-timestamp');
      if (timeStamp == 0) {
        return;
      }
      const timeLeft = timeStamp - (Math.floor(Date.now() / 1000));
      if (timeLeft < 0) {
        const closest = $(this).closest(".card.fifa22");
        $(closest).addClass("expired");
        $(closest).find(".token_objective_wrapper").addClass("expired");
        $(closest).find(".token_objective").html("EXPIRED");
        return;
      }
      const timeLeftDays = Math.floor(timeLeft / 86400);
      if (timeLeftDays <= 2) {
        const timeLeftHours = Math.floor(timeLeft / 3600);
        $(this).find(".token_objective").append('<b> (' + timeLeftHours + 'H)</b>');
      }
      if (timeLeftDays == 0) {
        $(this).closest(".card.fifa22").addClass("warning");
      }
    }
    );

  });



    


    





    
    function enable_futties() {
      let player_number = 0;
      $("#criminal").hide();
      $("#tokens").html("");
      $("body").addClass("futties");
      $(".header").hide();
      $(".futties-header").show();
      $("#overlay_bg").show();
      // add futties class to token div
      $('#tokens').addClass('futties');
      $.ajax({
        url: "https://freakpants.github.io/tokens/players.json",
      }).done(function (result) {
        console.log();
        result.forEach(function (player) {
          $('#tokens').append(player);
          player_number++;


        });
        // bind the click events again
        $(".marquee").click(function (event) {
          name_copy(event);
        });
        $('#tokens .card.fifa22').click(function () {
          const element = $(this);
          card_click(element);
        });

        add_darken_class();

        mark_tokens();
      });
    }





    if (document.futtiescollector) {
      enable_futties();
    }





</script>

</html>